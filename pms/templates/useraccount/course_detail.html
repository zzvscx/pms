{% extends 'useraccount/base.html'%}
{% load static %}
{% load get %}

{% block title %}
    <title>教务管理</title>
{% endblock %}

{% block head_extras %}
<link href=" {% static 'useraccount/css/base.css' %}" rel="stylesheet">
<link href=" {% static 'useraccount/css/user_detail.css' %}" rel="stylesheet">
<script src="https://img.hcharts.cn/highcharts/highcharts.js"></script>
<script src="https://img.hcharts.cn/highcharts/modules/exporting.js"></script>
<script src="https://img.hcharts.cn/highcharts/modules/data.js"></script>
<script src="https://img.hcharts.cn/highcharts/modules/drilldown.js"></script>
<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>

{% endblock %}

{% block sidebar %}
<li id='courses'><a href="{% url 'courses' %}">我的课程 </a></li>
<li id='my_lesson'><a href="{% url 'user_lesson' %}">我的课表</a></li>
{% endblock %}

{% block table %}

<div id="container" style="margin-left:320px; min-width: 250px; height: 300px;"></div>

<div class="form-group" style="margin-left:320px;" >
    <button id='btn_download' type="button" class="btn btn-lg btn-primary">下载成绩</button>
    <input type="file" id="file" />
    <input class= 'btn btn-lg btn-primary' type="button" id="btn" value="上传成绩" onclick="GetFile();" />
</div>
<div class="row">
        <div style="margin-left:300px;" class="table-responsive">
            <table style="width: 100%;margin:auto" class="table table-striped">
                <thead>
                    <tr>
                        <th>姓名</th>
                        <th>英文名</th>
                        <th>学号</th>
                        <th>期中考试成绩</th>
                        <th>期末考试成绩</th>
                        <th>平时成绩</th>
                        <th>实验成绩</th>
                        <th>补考成绩</th>
                        <th>总分</th>
                        <th>绩点</th>
                    </tr>
                </thead>
                <tbody>
                    {% for score in userscores %}
                    <tr>
                        <th>{{ score.user.name }}</th>
                        <th>{{ score.user.username }}</th>
                        <th>{{ score.user.stuId }}</th>
                        <td>{% if score.midterm %}{{ score.midterm }}{% endif %}</td>
                        <td>{% if score.final_exam %}{{ score.final_exam }}{% endif %}</td>
                        <td>{% if score.usual %}{{ score.usual }}{%endif%}</td>
                        <td>{% if score.experimental %}{{ score.experimental }}{% endif %}</td>                        
                        <td>{% if score.retest %}{{ score.retest }}{% endif %}</td>
                        <td>{% if score.total_points %}{{ score.total_score }}{% endif %}</td>
                        <td>{% if score.points %}{{ score.points }}{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
{% endblock %}

{% block js_extras %}
<style type="text/css">
    #file{ display:none;}
</style>
<script>
function GetFile() {
    $("#file").click();
    var formData = new FormData();
    formData.append('file',$('#file').get(0).files[0]);
    $.ajax({
        url: '/useraccount/course_detail/{{ pk }}/',
        type: 'POST',
        cache: false,
        data:  formData,
        processData: false,
        contentType: false,
    }).done(function(res){}).fail(function(res){});
}
$("#btn_download").click(function(){
    window.location=('/useraccount/course_detail/{{ course.id }}/?download=True');
    });
$('#courses').addClass('active');
$('li').click(function(){
    $(this).addClass('active').siblings().removeClass('active');
    });

$(function () {
    // Create the chart
    Highcharts.chart('container', {
        chart: {
            type: 'column'
        },
        title: {
            text: '成绩分布'
        },
        subtitle: {
            text: ''
        },
        xAxis: {
            type: 'category'
        },
        yAxis: {
            title: {
                text: '人数'
            }
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                    format: '{point.y}'
                }
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
            pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
        },
        series: [{
            name: '分布范围',
            colorByPoint: true,
            data: [{
                name: '不及格',
                y:  {% getnum userscores 'total_score' 0 59 %},
                drilldown: '0-59'
            }, {
                name: '良好',
                y: {% getnum userscores 'total_score' 60 89 %},
                drilldown: '60-89'
            }, {
                name: '优秀',
                y: {% getnum userscores 'total_score' 90 100 %},
                drilldown: '90-100'
            }, ]
        }],
        drilldown: {
            series: [{
                name: '0-59',
                id: '0-59',
                data: [
                    [
                        '0-9',
                        {% getnum userscores 'total_score' 0 9 %}
                    ],
                    [
                        '10-19',
                        {% getnum userscores 'total_score' 10 19 %}
                    ],
                    [
                        '20-29',
                        {% getnum userscores 'total_score' 20 29 %}
                    ],
                    [
                        '30-39',
                        {% getnum userscores 'total_score' 30 39 %}
                    ],
                    [
                        '40-49',
                        {% getnum userscores 'total_score' 40 49 %}
                    ],
                    [
                        '50-59',
                        {% getnum userscores 'total_score' 50 59 %}
                    ]
                ]
            }, {
                name: '60-89',
                id: '60-89',
                data: [
                    [
                        '60-69',
                        {% getnum userscores 'total_score' 60 69 %}
                    ],
                    [
                        '70-79',
                        {% getnum userscores 'total_score' 70 79 %}
                    ],
                    [
                        '80-89',
                        {% getnum userscores 'total_score' 80 89 %}
                    ],
                ]
            }, {
                name: '90-100',
                id: '90-100',
                data: [
                    [
                        '90-93',
                        {% getnum userscores 'total_score' 90 93 %}
                    ],
                    [
                        '94-96',
                        {% getnum userscores 'total_score' 94 96 %}
                    ],
                    [
                        '96-99',
                        {% getnum userscores 'total_score' 96 99 %}
                    ],
                    [
                        '100',
                        {% getnum userscores 'total_score' 100 100 %}
                    ],
                ]
            }, ]
        }
    });
});

</script>
{% endblock %}